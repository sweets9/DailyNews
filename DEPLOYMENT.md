# Deployment Guide

## Security Review Summary

All scripts in this repository are **safe to commit** - no hardcoded secrets or credentials.

### Files Safe to Commit:
- ✅ `fetch_cyber_news.py` - No secrets, safe subprocess usage
- ✅ `package.json` - Metadata only
- ✅ `.gitignore` - Standard ignores
- ✅ `README.md` - Documentation
- ✅ `.github/workflows/deploy.yml` - Uses GitHub secrets (no hardcoded values)

### CI/CD Requirements:

**Important**: The repository is hosted on `git.sweet6.net`, but the CI/CD workflow uses GitHub Actions. This will only work if:

1. **Option A**: Mirror the repo to GitHub (recommended for GitHub Actions)
2. **Option B**: Use a self-hosted GitHub Actions runner connected to your git server
3. **Option C**: Adapt the workflow for your CI/CD system (GitLab CI, Jenkins, etc.)

### Required GitHub Secrets:

Configure these in your GitHub repository settings (Settings → Secrets and variables → Actions):

- `PROD_HOST` - Production server hostname or IP
- `PROD_USER` - SSH user for deployment (e.g., `dailynews`)
- `PROD_SSH_KEY` - Private SSH key for deployment (generated by setup script)
- `PROD_DEPLOY_PATH` - Deployment path on production server (e.g., `/opt/DailyNews`)

### Production Server Requirements:

1. **SSH Access**: The deployment user must have SSH key-based authentication
2. **Sudo Access**: The deployment user needs passwordless sudo for:
   - Installing Node.js
   - Installing global npm packages
   - Managing systemd services
3. **Git**: Must be installed on production server
4. **Systemd**: Required for scheduled tasks (7am and 10am)

### Repository Configuration:

The script pushes directly to both remotes:
- **origin**: Gitea repository (`git.sweet6.net/Sweet6/DailyNews`)
- **github**: GitHub repository (`sweets9/DailyNews`)

Both remotes must be configured on the production server. See `GIT_REMOTES_SETUP.md` for detailed setup instructions.

### Setup Script:

The production setup script (`setup-dailynews-production.sh`) is included in the repository.

**Usage**:
```bash
# Clone the repository
git clone https://git.sweet6.net/Sweet6/DailyNews /opt/DailyNews

# Run setup script (requires sudo)
sudo bash /opt/DailyNews/setup-dailynews-production.sh
```

The script will:
- Install Node.js 22 and gemini-cli
- Create the `dailynews` service user
- Set up systemd timers for 7am and 10am runs
- Create `.env` file from template
- Configure git for the service user

**Note**: After setup, configure credentials in `.env` file. The script automatically configures git remotes using credentials from `.env`.

### Security Notes:

- All secrets are stored in GitHub Secrets (not in code)
- SSH keys are generated on the production server
- The deployment script cleans up SSH keys after use
- No credentials are logged or exposed in workflow output

